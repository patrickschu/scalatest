define("bundles/enroll/components/subscriptions/catalogSubscription/SubscriptionCertificatePaywallUpsellModal",["require","exports","module","react","naptime","bundles/phoenix/components/Modal","underscore","i18n!nls/enroll","bundles/naptimejs/resources/s12nDerivatives.v1","js/lib/coursera.react-intl","bundles/enroll/components/common/ValuePropBulletPoint","bundles/naptimejs/resources/courses.v1","bundles/naptimejs/resources/productPrices.v3","bundles/naptimejs/resources/subscriptions.v1","bundles/subscriptions/lib/subscriptionsV1Client","js/app/loggerSingleton","js/lib/coursera.redirect","js/lib/requestCountry","js/lib/user","js/lib/stringKeyTuple","bundles/payments/common/ProductType","bundles/naptimejs/resources/paymentWallets.v1","bundles/naptimejs/resources/subscriptionTrials.v1","bundles/payments-common/components/ReactPriceDisplay","bundles/page/components/TrackedButton","bundles/payments/common/PaymentProcessorTypes","bundles/iconfont/Icon","js/components/Imgix","bundles/coursera-ui/components/extended/Notification","css!./__styles__/SubscriptionCertificatePaywallUpsellModal"],function(require,exports,module){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _defaults(e,a){for(var s=Object.getOwnPropertyNames(a),t=0;t<s.length;t++){var r=s[t],n=Object.getOwnPropertyDescriptor(a,r);n&&n.configurable&&void 0===e[r]&&Object.defineProperty(e,r,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var n=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},F=require("react"),e=_interopRequireDefault(F),P=require("naptime"),a=_interopRequireDefault(P),I=require("bundles/phoenix/components/Modal"),T=_interopRequireDefault(I),O=require("underscore"),o=_interopRequireDefault(O),B=require("i18n!nls/enroll"),t=_interopRequireDefault(B),L=require("bundles/naptimejs/resources/s12nDerivatives.v1"),W=require("js/lib/coursera.react-intl"),r=W.FormattedMessage,g=require("bundles/enroll/components/common/ValuePropBulletPoint"),h=require("bundles/naptimejs/resources/courses.v1"),v=require("bundles/naptimejs/resources/productPrices.v3"),i=require("bundles/naptimejs/resources/subscriptions.v1"),w=require("bundles/subscriptions/lib/subscriptionsV1Client"),b=require("js/app/loggerSingleton"),G=require("js/lib/coursera.redirect"),C=require("js/lib/requestCountry"),l=require("js/lib/user"),E=require("js/lib/stringKeyTuple"),j=E.tupleToStringKey,s=require("bundles/payments/common/ProductType"),N=s.CATALOG_SUBSCRIPTION,S=s.VERIFIED_CERTIFICATE,u=s.SPECIALIZATION,D=require("bundles/naptimejs/resources/paymentWallets.v1"),d=require("bundles/naptimejs/resources/subscriptionTrials.v1"),M=require("bundles/payments-common/components/ReactPriceDisplay"),p=require("bundles/page/components/TrackedButton"),m=require("bundles/payments/common/PaymentProcessorTypes"),A=m.braintree,k=m.paypal,x=require("bundles/iconfont/Icon"),f=require("js/components/Imgix"),U=require("bundles/coursera-ui/components/extended/Notification"),R="https://s3.amazonaws.com/coursera_assets/growth_free_trial/free-trial-enrollment-confirmation.png",y=t["default"]("Earn an official certificate for {productName} to add to your LinkedIn profile"),c=[t["default"]("Access 2000+ courses to build any skill you need"),t["default"]("Personalized course recommendations based on your goals"),t["default"]("{monthlyPrice} per month"),t["default"]("Cancel anytime")],z=[t["default"]("Unlimited access to all courses in the Specialization"),t["default"]("{monthlyPrice} per month"),t["default"]("Cancel anytime")];require("css!./__styles__/SubscriptionCertificatePaywallUpsellModal");var q=function(a){function SubscriptionCertificatePaywallUpsellModal(){var r,e,n;_classCallCheck(this,SubscriptionCertificatePaywallUpsellModal);for(var s=arguments.length,o=Array(s),t=0;s>t;t++)o[t]=arguments[t];return r=e=_possibleConstructorReturn(this,a.call.apply(a,[this].concat(o))),e.state={showConfirmationState:!1,showLoadingIcon:!1},e.closeModal=function(){e.state.showConfirmationState&&window&&window.setTimeout(function(){return G.refresh()},500),e.props.handleClose()},e.upgradeFromFreeTrial=function(){var t=e.props.subscription;w.upgradeFromTrial(t.id).then(function(){e.setState(function(){return{showLoadingIcon:!1,showConfirmationState:!0}})}).done()},n=r,_possibleConstructorReturn(e,n)}return _inherits(SubscriptionCertificatePaywallUpsellModal,a),SubscriptionCertificatePaywallUpsellModal.prototype.getBillingMethod=function getBillingMethod(){var n=this.props.paymentWallet;if(!n)return b.error("No payment wallet"),null;var a=n.paymentProcessorId,s=n.creditCardLastFourDigits,o=n.email;return a===A&&s?e["default"].createElement(r,{message:t["default"]("your card ending with {creditCardLastFourDigits}"),creditCardLastFourDigits:s}):a===k&&o?e["default"].createElement(r,{message:t["default"]("your PayPal account with email address {email}"),email:o}):(b.error("Unsupported payment type "+a),null)},SubscriptionCertificatePaywallUpsellModal.prototype.getBulletData=function getBulletData(){var n=this.props,a=n.catalogSubscriptionPrice,s=n.s12nDerivative,o=n.course;if(!a&&!s)return null;var i=a||s.catalogPrice,l=i.amount,c=i.currencyCode;return{monthlyPrice:e["default"].createElement(M,{currency:c,value:l,hideCurrencyCode:!0}),productName:o?e["default"].createElement("strong",null,e["default"].createElement(r,{message:t["default"]("{productName}"),productName:o.name})):null}},SubscriptionCertificatePaywallUpsellModal.prototype.getBullets=function getBullets(){var e=this.props,r=e.course,t=e.subscription;return t&&t.ProductType===u?[y].concat(z):r?[y].concat(c):c},SubscriptionCertificatePaywallUpsellModal.prototype.render=function render(){var i=this.props.paymentWallet,s=this.state,c=s.showConfirmationState,o=s.showLoadingIcon,a=this.getBulletData();if(!a||!i)return null;var u=a.monthlyPrice;return e["default"].createElement(T["default"],{className:"rc-SubscriptionCertificatePaywallUpsellModal",modalName:t["default"]("Certificate Paywall"),handleClose:this.closeModal,allowClose:!o},c?e["default"].createElement("div",{className:"certificate-paywall-confirm align-horizontal-center"},e["default"].createElement(f,{alt:f.DECORATIVE,src:R,width:400,height:400}),e["default"].createElement("h2",{className:"certificate-paywall-confirm-headline"},t["default"]("Thank you")),e["default"].createElement("p",{className:"email-message"},e["default"].createElement(r,{message:t["default"]("We've sent a receipt to your email {emailAddress}"),emailAddress:l.get().email_address})),e["default"].createElement(p,{className:"primary comfy",trackingName:"certficate_paywall_confirm_close",onClick:this.closeModal},t["default"]("Close"))):e["default"].createElement("div",{className:"certificate-paywall-content"},e["default"].createElement("h2",{className:"certificate-paywall-headline headline-5-text"},t["default"]("Prove your mastery")),e["default"].createElement("ul",{className:"nostyle certificate-paywall-value-props"},this.getBullets().map(function(t,s){return e["default"].createElement("li",{className:"certificate-paywall-bullet",key:"bullet-"+s},e["default"].createElement(g,null,e["default"].createElement("p",{className:"certificate-paywall-description"},e["default"].createElement(r,n({message:t},a)))))})),e["default"].createElement(U,{type:"info",iconSize:40,style:{"margin-bottom":"20px"},message:e["default"].createElement("p",{className:"payment-method-information"},e["default"].createElement(r,{message:t["default"]("By clicking Continue, {billingMethod} will be billed {monthlyPrice} per month beginning today, until you cancel your subscription"),billingMethod:this.getBillingMethod(),monthlyPrice:u}))}),e["default"].createElement("div",{className:"cta-container"},e["default"].createElement(p,{className:"primary comfy",trackingName:"certficate_paywall_confirm",onClick:this.upgradeFromFreeTrial},o?e["default"].createElement(x,{name:"spinner",className:"cif-spin"}):t["default"]("Pay Now")))))},SubscriptionCertificatePaywallUpsellModal}(e["default"].Component),K=a["default"].createContainer(function(t){var e=t.subscription;return n({},e&&{paymentWallet:D.get(e.paymentWalletId,{fields:["paymentProcessorId","email","creditCardLastFourDigits"]})})})(q),V=a["default"].createContainer(function(n){var d=n.courseId,e=n.subscriptionTrials;if(e&&e.length){var t=o["default"](e).find(function(e){var t=e.productType;return t===N}),r=o["default"](e).find(function(e){var t=e.productType;return t===u});if(t){var a=t.subscriptionId,s=t.productItemId;return{subscription:i.get(a,{fields:["paymentInformation"]}),catalogSubscriptionPrice:v.getCatalogSubscriptionProductPrice(s,C.get())}}if(r){var l=r.subscriptionId,c=r.productItemId;return{subscription:i.get(l,{fields:["paymentInformation"]}),s12nDerivative:L.get(c,{fields:["catalogPrice"]})}}return{}}return{}})(K);module.exports=a["default"].createContainer(function(a){var e=a.courseId,t=l.get().id,r=void 0;return r=e?d.finder("findActiveTrialsForUserAndProduct",{params:{userId:t,productId:j([S,e])},fields:["subscriptionId","productType","productItemId"]}):d.finder("findByUser",{params:{userId:t},fields:["subscriptionId","productType","productItemId"]}),n({},e&&{course:h.get(e,{fields:["name"]})},{subscriptionTrials:r})})(V)});