define("pages/open-course/common/utils/ensureEnrolled",["require","exports","module","jquery","react","react-dom","q","bundles/certificate-enroll/components/OpenCourseEnrollModal","bundles/s12n-enroll/components/StandaloneEnrollModal","bundles/ondemand/components/ContentRequiresEnrollModal","pages/open-course/common/promises/membership","pages/open-course/common/promises/membership","bundles/s12n/service/promises/s12ns"],function(require,exports,module){"use strict";var $=require("jquery"),e=require("react"),o=require("react-dom"),s=require("q"),c=require("bundles/certificate-enroll/components/OpenCourseEnrollModal"),l=require("bundles/s12n-enroll/components/StandaloneEnrollModal"),m=require("bundles/ondemand/components/ContentRequiresEnrollModal"),t=require("pages/open-course/common/promises/membership"),i=require("pages/open-course/common/promises/membership"),d=require("bundles/s12n/service/promises/s12ns"),n=function UserRejectedEnrollPromptException(){},r=function ensureEnrolled(p,r,u){var a=r.get("id");return t(p,a).then(function(t){return t.hasEnrolledRole()?s():d.primaryS12ns(a,p).then(function(g){var E=g.at(0);if(E&&u.get("productOwnership.owns"))return i(p,a).invoke("enroll");var t=s.defer(),b=$("<div></div>").appendTo("body"),d=void 0;return E?(d=e.createElement(l,{s12nId:E.get("id"),courseIdOverride:a,showFreeOption:!E.get("membership").isEnrolled(),isContentGate:!0,onFail:t.reject.bind(t,new n),onEnroll:t.resolve}),o.render(d,b.get(0))):r.isCertificatePurchaseEnabled()?0===$(".rc-PhoenixEnrollModal").length&&(d=e.createElement(c,{course:r}),o.render(d,b.get(0))):(d=e.createElement(m,{course:r,onClose:t.reject.bind(t,new n)}),o.render(d,b.get(0))),t.promise["finally"](b.remove.bind(b))})})};r.UserRejectedEnrollPromptException=n,module.exports=r});